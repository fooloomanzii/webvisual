<dom-module id="select-page">
  <template>
  <style>
    :host {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: var(--bright-text-color);
    }
    :host[dark] {
      color: var(--highlight-color);
    }
    section#background {
      @apply(--background);
      background: var(--primary-color-background);
      z-index: 95;
      box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14),
                  0 1px 10px 0 rgba(0, 0, 0, 0.12),
                  0 2px 4px -1px rgba(0, 0, 0, 0.4);
    }
    section#background[dark] {
      background: var(--dark-primary-color);
    }
    section#mainContent {
      box-sizing: border-box;
      display: block;
      border: none;
      outline: none;
      width: auto;
      height: auto;
      padding: 1.5em;
      z-index: 100;
    }
    section.title {
      font-size: 2em;
      line-height: normal;
      margin: 0.67em 0em;
      text-align: center;
    }
    section#select {
      font-family: Fira Sans Light;
      font-size: 1em;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: currentColor;
    }
    iron-selector#labelSelector {
      color: currentColor;
    }

    iron-selector#labelSelector ::content radio-button-element  {
      padding: 1em;
    }

    span {
      font-size: 1.2em;
      padding: 1em 1em 0.75em 1em;
    }
    circle-element#loader {
      margin-top: 2.5em;
    }
    button-element#submitButton {
      /*margin-left: auto;*/
      margin-top: 1.5em;
      border-style: solid;
      border-width: thin;
    }
    iron-icon#logo {
      visibility: visible !important;
    }
  </style>

    <section id="background"></section>
    <section id="mainContent">
      <section class="title">Auswahl der Konfiguration</section>
      <section id="select">
        <span>verf√ºgbar sind:</span>
        <iron-selector id="labelSelector" selected-values="[[selectedLabels]]" on-iron-select="_disableButton" on-iron-deselect="_disableButton" multi attr-for-selected="label" selected-attribute="checked">
          <content></content>
        </iron-selector>
        <button-element id="submitButton" disabled raised on-tap="_submit"><iron-icon id="logo" icon="juelich:logo" class="left"></iron-icon>Verbinden</button-element>
        <circle-element id="loader"></circle-element>
      </section>
    </section>

    <cookie-element id="labelsCookie" name="selected-label"></cookie-element>
  </template>

  <script>

  Polymer({
      is: 'select-page',

      behaviors: [Polymer.NeonSharedElementAnimatableBehavior, Polymer.NeonAnimationRunnerBehavior],

      properties: {
        active: {
          type: Boolean,
          value: false,
          observer: "activeChanged"
        },
        selectedLabels: {
          type: Array,
          value: function() { return [];},
          notify: true
        },
        sharedElements: {
          type: Object,
          value: function() {
            return {
              'herologo': this.$.logo
            }
          }
        },
        animationConfig: {
          value: function() {
            return {
              'entry': [
                {
                  name: 'fade-in-animation',
                  node: this.$.background,
                  timing: {
                    duration: 1000,
                    delay: 0,
                    easing: 'ease'
                  }
                },
                {
                  name: 'scale-up-animation',
                  node: this.$.mainContent,
                  timing: {
                    duration: 500,
                    delay: 0,
                    easing: 'ease'
                  }
                }
              ],
              'exit': [
                {
                  name: 'hero-animation',
                  id: 'herologo',
                  fromPage: this,
                },
                {
                  name: 'slide-up-animation',
                  node: this.$.background,
                  timing: {
                    duration: 500,
                    delay: 0,
                    easing: 'ease'
                  }
                },
                {
                  name: 'fade-out-animation',
                  node: this.$.mainContent,
                  timing: {
                    duration: 300,
                    delay: 0,
                    easing: 'linear'
                  }
                }
              ]
            }
          }
        }
      },

      observers: [
          "_one(labels)"
      ],

      attached: function() {
        if (window.Labels && window.Labels.length === 1) {
          window.selectedLabels = this.selectedLabels = window.Labels;
          this._setSelected(window.Labels[0]);
          this._submit();
        }
        else {
          var preconf = JSON.parse(localStorage.getItem(window.Name));
          if (preconf && preconf.selectedLabels) {
              this._setSelected(preconf.selectedLabels);
          }
        }
      },

      _setSelected: function(labels) {
        if (!labels) return;
        var labelSelector = this.$.labelSelector;
        for (var i in labels) {
          if (Labels.indexOf(labels[i]) !== -1)
            labelSelector.select(labels[i]);
        }
      },

      _disableButton: function() {
        if (this.selectedLabels.length === 0)
          this.$.submitButton.setAttribute('disabled', true);
        else
          this.$.submitButton.removeAttribute('disabled');
      },

      _submit: function() {
        this.$.loader.play();
        // save the label to LocalStorage
        window.selectedLabels = this.selectedLabels;
        localStorage.setItem(window.Name, JSON.stringify({selectedLabels: this.selectedLabels}));
        // connect the datasocket
        window.DataHandler.connect(this.selectedLabels);
      },
      activeChanged: function() {
        // if (!this.active) {
          this.$.loader.cancel();
        // }
      }
    });
  </script>

</dom-module>
