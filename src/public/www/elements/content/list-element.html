<link rel="import" href="../behaviors/color-behavior.html"/>
<link rel="import" href="../behaviors/checked-and-select-behavior.html"/>
<link rel="import" href="../behaviors/drag-and-drop-behavior.html"/>
<link rel="import" href="../behaviors/element-behavior.html"/>
<dom-module id='list-element'>
  <template>
    <style>
      :host {
        cursor: pointer;
        position: relative;
        box-sizing: border-box;
        border-radius: 5px;
        overflow: hidden;
        outline: none;
        -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
        -webkit-touch-callout: none; -webkit-tap-highlight-color:rgba(0,0,0,0);
        align-self: stretch;
        display: inline-flex;
        flex-direction: row;
        justify-content: space-between;
        border-radius: inherit;
        border: thin solid rgba(0,0,0,.16);
        background: white;
        z-index: auto;
      }
      :host([dark]) {
        background: #C1C1C1;
      }
      :host([checked]) {
        @apply(--shadow-elevation-2dp);
      }
      .list-element {
        position: relative;
      }
      #sign {
        min-width: 2em;
        position: relative;
        padding: 0;
        margin: 0;
        width: auto;
        background: var(--element-color);
        color: var(--element-text-color);
        height: auto;
        width: auto;
        box-sizing: border-box;
        line-height: 1;
        transition: background 300ms cubic-bezier(0.4, 0, 0.2, 1);
      }
      #sign[inrange] {
        background: var(--element-state-inrange-color);
        color: var(--element-state-inrange-text-color);
      }
      #sign[exceeds] {
        background: var(--element-state-exceeds-color);
        color: var(--element-state-exceeds-text-color);
      }
      #sign[deceeds] {
        background: var(--element-state-deceeds-color);
        color: var(--element-state-deceeds-text-color);
      }
      #sign[undefined] {
        background: var(--element-state-undefined-color);
        color: var(--element-state-undefined-text-color);
      }
      #sign > section {
        padding: 0.5em;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        width: 100%;
        box-sizing: border-box;
        background: linear-gradient(180deg,rgba(255,255,255,0),rgba(230,230,230,0.2),rgba(255,255,255,0));
      }
      #valueSection {
        font-size: 0.9em;
        padding: 0;
        margin: 0;
        float: left;
      }
      #unitSection {
        margin-left: 0.25em;
        font-size: 0.75em;
        float: right;
      }
      #label {
        color: #333333;
        writing-mode: vertical-lr;
        -ms-writing-mode: tb-rl;
        font-size: 0.6em;
        text-align: center;
        padding: 0.5em 0;
        width: 3em;
        font-weight: normal;
      }
      svg#icon {
        height: 1em;
        width: 1em;
        fill: currentColor;
      }
      #dateSection {
        font-size: 0.6em;
        color: var(--primary-text-color);
        align-self: center;
        text-align: center;
        min-width: 5em;
        padding: 0.5em;
        box-sizing: border-box;
        position: relative;
      }
      [hidden] {
        display: none !important;
      }
    </style>

    <section id='label'>[[label]]</section>

    <section id='sign' status="inrange">
      <section hidden$="[[isBoolean]]">
        <section id='valueSection'></section>
        <section id='unitSection' hidden$="[[!unit]]">[[unit]]</section>
      </section>
      <section hidden$="[[!isBoolean]]">
        <svg id='icon' hidden$='[[!isExceeding]]' viewBox='0 0 24 24'>
          <g id='error-outline'><path d='M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z'/></g>
        </svg>
      </section>
    </section>

    <caption-element vertical$="[[vertical]]" grouped-key='[[groupedKey]]' keys='[[keys]]'></caption-element>

    <section id='dateSection' hidden$='[[!showDate]]'></section>
  </template>

  <script>

    ListElement = Polymer({
      is: 'list-element',

      behaviors: [
        ColorBehavior,
        CheckedAndSelectBehavior,
        DragAndDropBehavior,
        ElementBehavior
      ],

      properties: {
        showDate: {
          type: Boolean,
          value: true
        },
        selectable: {
          type: Boolean,
          value: true
        },
        vertical: {
          type: Boolean,
          value: false
        },
        updateEveryValue: {
          type: Boolean,
          value: false,
          readOnly: true
        }
      },

      listeners: {
        'click': 'select'
      },

      _value: Object,
      _date: Object,
      _sign: Object,

      attached: function() {
        this._value = this.$.valueSection;
        this._date = this.$.dateSection;
        this._sign = this.$.sign;
        this.insertValues();
      },

      setExceedingStatus: function(state) {
        var status;

        if (this._sign.hasAttribute("inrange"))
          this._sign.removeAttribute("inrange");
        if (this._sign.hasAttribute("deceeds"))
          this._sign.removeAttribute("deceeds");
        if (this._sign.hasAttribute("exceeds"))
          this._sign.removeAttribute("exceeds");
        if (this._sign.hasAttribute("undefined"))
          this._sign.removeAttribute("undefined");
        // set color of the sign
        switch (state) {
          case 0: status = "inrange"; break;
          case -1: status = "deceeds"; break;
          case 1: status = "exceeds"; break;
          default: status = "undefined";
        }
        this._sign.setAttribute(status, '');
      },

      render: function(value) {
        if (value === undefined) {
          if (this.values && this.values.length) {
            value = this.values[this.values.length - 1];
          } else {
            return;
          }
        }

        // set value
        if (this.isBoolean === false) {
          this._value.innerText = value.y;
        }

        // set date
        if (this.showDate === true) {
          this._date.innerText = new Date(value.x).toLocaleTimeString();
        }
      }
    });
  </script>

</dom-module>
