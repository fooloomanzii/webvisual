<link rel='import' href='../behaviors/element-behavior.html'>
<dom-module id='list-element'>
  <template>
  <style>
    :host {
      cursor: pointer;
      position: relative;
      box-sizing: border-box;
      border-radius: 5px;
      overflow: hidden;
      outline: none;
      -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
      -webkit-touch-callout: none; -webkit-tap-highlight-color:rgba(0,0,0,0);
      align-self: stretch;
      display: inline-flex;
      flex-direction: row;
      justify-content: space-between;
      border-radius: inherit;
      border: thin solid rgba(0,0,0,.16);
      background: white;
      z-index: auto;
      transition: box-shadow 0.28s cubic-bezier(0.4, 0, 0.2, 1);
    }
    :host[dark] {
      background: #C1C1C1;
    }
    :host[checked] {
      @apply(--shadow-elevation-2dp);
    }
    section.list-element {
      position: relative;
    }
    section#sign {
      min-width: 2em;
      position: relative;
      padding: 0;
      margin: 0;
      width: auto;
      background: var(--element-color);
      color: var(--element-text-color);
      height: auto;
      width: auto;
      box-sizing: border-box;
      line-height: 1;
    }
    section#sign.inrange {
      background: var(--element-state-inrange-color);
      color: var(--element-state-inrange-text-color);
    }
    section#sign.exceeds {
      background: var(--element-state-exceeds-color);
      color: var(--element-state-exceeds-text-color);
    }
    section#sign.deceeds {
      background: var(--element-state-deceeds-color);
      color: var(--element-state-deceeds-text-color);
    }
    section#sign.undefined {
      background: var(--element-state-undefined-color);
      color: var(--element-state-undefined-text-color);
    }
    :host[dark] section#sign {
      color: #d3d3d3;
    }
    section#sign > section {
      padding: 0.5em;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      width: 100%;
      box-sizing: border-box;
      background: linear-gradient(180deg,rgba(255,255,255,0),rgba(230,230,230,0.2),rgba(255,255,255,0));
    }
    section#valueSection {
      font-size: 0.9em;
      padding: 0;
      margin: 0;
      float: left;
    }
    section#unitSection {
      margin-left: 0.25em;
      font-size: 0.75em;
      float: right;
    }
    section#label {
      color: #333333;
      writing-mode: vertical-lr;
      -ms-writing-mode: tb-rl;
      font-size: 0.6em;
      text-align: center;
      padding: 0.5em 0;
      width: 3em;
      font-weight: normal;
    }
    section#caption {
      border-top-left-radius: 0;
      border-top-right-radius: 0;
      border-bottom-left-radius: inherit;
      border-bottom-right-radius: inherit;
      color: #1f1f1f;
      line-height: 1;
      padding: 0.5em 0.5em 0.5em 0em;
      display: flex;
      flex-direction: row;
      flex: 1 0 auto;
      align-items: center;
      margin: 0;
      width: auto;
    }
    :host[dark] section#caption {
      color: #1d1d1d;
    }
    section#caption span.captions {
      padding: 0;
      margin: 0;
      margin-left: 0.5em;
      font-weight: normal;
      font-size: 0.6em;
      word-wrap: break-word;
      word-break: break-all;
    }
    span.captions:first-child {
      margin-left: 0 !important;
      font-weight: bold !important;
      font-size: 1em !important;
      word-wrap: normal !important;
      word-break: keep-all !important;
    }
    span.captions:nth-child(2) {
      font-size: 0.85em !important;
    }
    span.captions:nth-child(3) {
      font-size: 0.75em !important;
    }
    svg#icon {
      height: 1em;
      width: 1em;
      fill: currentColor;
    }
    section#dateSection {
      font-size: 0.6em;
      color: var(--primary-text-color);
      align-self: center;
      text-align: center;
      min-width: 5em;
      padding: 0.5em;
      box-sizing: border-box;
      position: relative;
    }
  </style>
    <section id='label'>[[label]]</section>

    <section id='caption'>
      <template is='dom-repeat' items='[[getReducedCaptionKeys(groupedKey, keys.*)]]' as='captionKey'>
        <span class='captions' hidden$='[[isEmptyCaption(captionKey, groupedKey)]]'>[[getKey(captionKey, reducedCaptionKeys.*)]]</span>
      </template>
    </section>

    <section id='sign' class='inrange'>
      <section hidden$="[[isBoolean]]">
        <section id='valueSection'></section>
        <section id='unitSection' hidden$="[[!unit]]">[[unit]]</section>
      </section>
      <section hidden$="[[!isBoolean]]">
        <svg id='icon' hidden$='[[!isExceeding]]' viewBox='0 0 24 24'>
          <g id='error-outline'><path d='M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z'/></g>
        </svg>
      </section>
    </section>
    <section id='dateSection' hidden$='[[!showDate]]'></section>
  </template>

  <script>

    ListElement = Polymer({
      is: 'list-element',

      behaviors: [ElementBehavior],

      properties: {
        showDate: {
          type: Boolean,
          value: true
        },
        ariaLabel: {
          value: 'gsfdgfsg',
          reflectToAttribute: true

        },
        selectable: {
          type: Boolean,
          value: true
        },
        exeedable: {
          type: Boolean,
          value: true
        },
        updateEveryValue: {
          type: Boolean,
          value: false,
          readOnly: true
        },

        draggable: {
          type: Boolean,
          value: true
        },
        droppable: {
          type: Boolean,
          value: true
        }
      },

      listeners: {
        'click': '_select'
      },

      _value: Object,
      _date: Object,
      _sign: Object,

      attached: function() {
        this._value = this.$.valueSection;
        this._date = this.$.dateSection;
        this._sign = this.$.sign;
      },

      setExceedingStatus: function(isExceeding, state) {
        var status;
        this.set('isExceeding', isExceeding);
        // set color of the sign
        switch (state) {
          case 0: status = 'inrange'; break;
          case -1: status = 'deceeds'; break;
          case 1: status = 'exceeds'; break;
          default: status = 'undefined';
        }
        this._sign.className = status + " style-scope list-element";
      },

      render: function(value) {
        if (value === undefined)
          return;

        // set value
        if (this.isBoolean === false) {
          this._value.innerText = value.y;
        }

        // set date
        if (this.showDate === true) {
          this._date.innerText = new Date(value.x).toLocaleTimeString();
        }
      }
    });
  </script>

</dom-module>
