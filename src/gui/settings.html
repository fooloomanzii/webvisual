<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <script src="scripts/jsoneditor.min.js"></script>
    <script src="scripts/ajv.min.js"></script>
    <link rel="stylesheet" href="style/jsoneditor.css">
    <script>
      const {
        ipcRenderer
      } = require('electron');
    </script>

    <title></title>
  </head>

  <style>
    @font-face {
      font-family: 'FiraSans-Light';
      src: url('./style/fonts/FiraSans-Light.ttf') format('truetype');
    }
    @font-face {
      font-family: 'FiraMono-Regular';
      src: url('./style/fonts/FiraMono-Regular.ttf') format('truetype');
    }
    body {
      height: 100%;
      width: 100%;
      padding: 0;
      margin: 0;
      box-sizing: border-box;
      background: var(--bright-primary-color);
      font-family: FiraSans-Light;
      font-weight: normal;
    }
    body > * {
      position: relative;
    }
    #container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      box-sizing: border-box;
    }
  </style>

  <body>
    <div id="container"></div>
  </body>

  <script type="text/javascript">
    var container = document.querySelector('#container');
    var json, editor, schema, ajv, defaults = {};

    ipcRenderer.on("set", function(e, arg) {
      console.log(arg)
      if (arg.title) {
        window.title = arg.title;
      }
      if (!editor) {
        ajv = new Ajv({ useDefaults: true });
        editor = new JSONEditor(container, {mode: 'tree', modes: ['tree', 'text'], ajv: ajv, search: false, name: arg.title, sortObjectKeys: false});
      }
      if (arg.schema) {
        schema = arg.schema || schema;
        editor.setSchema(schema);
        editor.set(schema.default);
      }
      if (arg.value) {
        editor.set(arg.value);
      }
      editor.expandAll()
    });
    ipcRenderer.on("get", function(e, arg) {
      if (editor) {
        json = editor.get();
        ipcRenderer.send("set", json);
      }
    });
    ipcRenderer.send("event", "ready");
  </script>
</html>
